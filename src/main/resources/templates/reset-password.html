<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reset Password | TimeIt</title>

    <link rel="stylesheet" href="/css/pswd.css" />
    <link rel="stylesheet" href="/css/footer.css" />
    <link rel="icon" type="image/png" href="/images/logo.png" />
  </head>

  <body>
    <div th:if="${errorMessage}" class="popup-error">
      <span th:text="${errorMessage}"></span>
    </div>

    <div th:if="${successMessage}" class="popup-success">
      <span th:text="${successMessage}"></span>
    </div>

    <div class="blob shape-1"></div>
    <div class="blob shape-2"></div>
    <div class="blob shape-3"></div>

    <div class="forgot-container">
      <div class="forgot-card">
        <div class="forgot-title">Reset Password</div>

        <div class="forgot-subtitle">
          Enter a new password to update your account credentials.
        </div>

        <form th:action="@{/auth/reset-password}" method="post">
          <input type="hidden" name="email" th:value="${email}" />

          <div class="password-group">
            <div class="input-group">
              <label>Password</label>
              <input
                type="password"
                name="password"
                placeholder="••••••••"
                required
              />
            </div>

            <div class="input-group tooltip-wrapper">
              <label>Confirm Password</label>
              <input
                type="password"
                name="confirmPassword"
                placeholder="••••••••"
                required
              />
              <span class="tooltip-text">Passwords do not match</span>
            </div>
          </div>

          <input type="submit" value="Reset Password" class="submit-btn" />
        </form>

        <div class="back-login">
          <a th:href="@{/auth/login}">Back to Login</a>
        </div>
      </div>
    </div>

    <div th:replace="~{fragments/footer :: footer}"></div>

    <script>
      const passwordInput = document.querySelector('input[name="password"]');
      const confirmPasswordInput = document.querySelector(
        'input[name="confirmPassword"]'
      );
      const tooltipWrapper = confirmPasswordInput.parentElement;
      const submitBtn = document.querySelector(".submit-btn");

      function validatePasswordsLive() {
        if (!confirmPasswordInput.value) {
          tooltipWrapper.classList.remove("invalid");
          submitBtn.disabled = false;
          submitBtn.style.opacity = "1";
          return;
        }

        if (passwordInput.value !== confirmPasswordInput.value) {
          tooltipWrapper.classList.add("invalid");
          submitBtn.disabled = true;
          submitBtn.style.opacity = "0.6";
        } else {
          tooltipWrapper.classList.remove("invalid");
          submitBtn.disabled = false;
          submitBtn.style.opacity = "1";
        }
      }

      passwordInput.addEventListener("input", validatePasswordsLive);
      confirmPasswordInput.addEventListener("input", validatePasswordsLive);
    </script>
  </body>
</html>
